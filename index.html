<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒˆ ì‹ ë‚˜ëŠ” ì˜ì–´ ë‹¨ì–´ í€´ì¦ˆ! ğŸŒˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            font-family: 'Jua', sans-serif;
            background: linear-gradient(to right, #FFC0CB, #ADD8E6); /* í•‘í¬ ğŸ’™ í•˜ëŠ˜ìƒ‰ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            text-align: center;
            overflow: hidden;
            position: relative;
        }
        body::before {
            content: 'ğŸˆ';
            position: absolute;
            top: 10%;
            left: 5%;
            font-size: 50px;
            animation: floaty 3s infinite alternate;
        }
        body::after {
            content: 'ğŸ';
            position: absolute;
            bottom: 15%;
            right: 8%;
            font-size: 40px;
            animation: floaty 3.5s infinite alternate-reverse;
        }
        @keyframes floaty {
            0% { transform: translateY(0); opacity: 0.8; }
            100% { transform: translateY(-15px); opacity: 1; }
        }

        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            animation: fadeIn 1s ease-out;
            position: relative;
            z-index: 1;
            border: 5px solid #FFD700; /* í™©ê¸ˆìƒ‰ í…Œë‘ë¦¬ */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #FF69B4; /* í•«í•‘í¬ */
            margin-bottom: 25px;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #4CAF50; /* ì´ˆë¡ */
            margin-bottom: 20px;
            font-size: 2.2em;
        }

        p {
            font-size: 1.5em;
            margin-bottom: 25px;
            color: #555;
        }

        input[type="text"] {
            width: calc(100% - 40px);
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 2px solid #FFD700; /* í™©ê¸ˆìƒ‰ */
            border-radius: 15px;
            font-size: 1.4em;
            text-align: center;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus {
            border-color: #9370DB; /* ë³´ë¼ìƒ‰ */
            box-shadow: 0 0 10px rgba(147, 112, 219, 0.4);
            outline: none;
        }

        .button {
            background-color: #87CEEB; /* ìŠ¤ì¹´ì´ë¸”ë£¨ */
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.6em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            margin: 10px;
        }
        .button:hover {
            background-color: #6A5ACD; /* ìŠ¬ë ˆì´íŠ¸ë¸”ë£¨ */
            transform: translateY(-3px);
        }
        .button:active {
            transform: translateY(0);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        .option-button {
            background-color: #FFDAB9; /* í”¼ì¹˜í¼í”„ */
            color: #333;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .option-button:hover {
            background-color: #FFA07A; /* ë¼ì´íŠ¸ì‚´ëª¬ */
            transform: translateY(-2px);
        }
        .option-button:active {
            transform: translateY(0);
        }
        .option-button.correct {
            background-color: #90EE90; /* ë¼ì´íŠ¸ê·¸ë¦° */
            color: white;
        }
        .option-button.incorrect {
            background-color: #FF6347; /* í† ë§ˆí†  */
            color: white;
        }

        .feedback {
            margin-top: 20px;
            font-size: 1.8em;
            font-weight: bold;
            color: #FF4500; /* ì˜¤ë Œì§€ë ˆë“œ */
            animation: bounceIn 0.5s ease-out;
        }
        .feedback.correct-feedback {
            color: #32CD32; /* ë¼ì„ê·¸ë¦° */
        }
        .feedback.incorrect-feedback {
            color: #FF4500; /* ì˜¤ë Œì§€ë ˆë“œ */
        }

        .feedback-buttons .button {
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 1.2em;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none !important; /* !importantë¡œ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë³´ë‹¤ ìš°ì„  ì ìš© */
        }

        .welcome-image {
            max-width: 80%;
            height: auto;
            margin-bottom: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .score {
            font-size: 2.5em;
            color: #FF1493; /* ë”¥í•‘í¬ */
            margin-top: 30px;
            font-weight: bold;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .progress-indicator {
            font-size: 1.2em;
            color: #4682B4; /* ìŠ¤í‹¸ë¸”ë£¨ */
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* Stage Navigator styles */
        .stage-navigator {
            position: fixed; /* ê³ ì • ìœ„ì¹˜ */
            right: 20px;
            top: 20px; /* ìƒë‹¨ì—ì„œ ì‹œì‘ */
            bottom: 20px; /* í•˜ë‹¨ê¹Œì§€ í™•ì¥ */
            width: 200px; /* ë„ˆë¹„ ê³ ì • */
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
            overflow-y: auto; /* ë‚´ìš©ì´ ë„˜ì¹  ê²½ìš° ìŠ¤í¬ë¡¤ */
            align-items: stretch; /* ë²„íŠ¼ ë„ˆë¹„ ë§ì¶¤ */
            border: 3px solid #BA55D3; /* ë¯¸ë””ì›€ì˜¤í‚¤ë“œ */
        }

        .stage-navigator .nav-button {
            background-color: #DA70D6; /* ì˜¤í‚¤ë“œ */
            color: white;
            padding: 12px 10px; /* íŒ¨ë”© ì¡°ì • */
            border: none;
            border-radius: 10px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            margin-bottom: 5px; /* ë²„íŠ¼ ì•„ë˜ ì—¬ë°± */
            text-align: left; /* í…ìŠ¤íŠ¸ ì™¼ìª½ ì •ë ¬ */
            display: flex;
            justify-content: space-between; /* í…ìŠ¤íŠ¸ì™€ ì•„ì´ì½˜ ë¶„ë¦¬ */
            align-items: center;
        }

        .stage-navigator .nav-button:hover {
            background-color: #C71585; /* ë¯¸ë””ì›€ë°”ì´ì˜¬ë ›ë ˆë“œ */
            transform: scale(1.02);
        }

        .stage-navigator .nav-button.active {
            background-color: #8A2BE2; /* ë¸”ë£¨ë°”ì´ì˜¬ë › */
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        .stage-navigator .nav-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* Question Outline (Tree Structure) */
        .question-list {
            list-style: none;
            padding: 0;
            margin: 0;
            margin-left: 10px; /* ë“¤ì—¬ì“°ê¸° */
            text-align: left;
            overflow: hidden; /* transitionì„ ìœ„í•´ í•„ìš” */
            max-height: 0; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            transition: max-height 0.3s ease-out; /* ë¶€ë“œëŸ¬ìš´ í¼ì¹¨/ì ‘í˜ */
        }

        .question-list.open {
            max-height: 500px; /* ì¶©ë¶„íˆ í° ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  ë‚´ìš© í‘œì‹œ */
        }

        .question-list li {
            position: relative; /* O/X ì•„ì´ì½˜ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•´ */
            padding: 5px 0 5px 20px; /* O/X ì•„ì´ì½˜ ê³µê°„ í™•ë³´ */
            font-size: 0.95em;
            color: #555;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .question-list li:hover {
            color: #DA70D6; /* ì˜¤í‚¤ë“œ */
            font-weight: bold;
        }

        .question-list li.current {
            color: #FF4500; /* ì˜¤ë Œì§€ë ˆë“œ */
            font-weight: bold;
            background-color: #FFDAB9; /* í”¼ì¹˜í¼í”„ */
            padding-left: 20px;
            border-radius: 5px;
        }

        /* O/X ì•„ì´ì½˜ */
        .question-list li:after {
            position: absolute;
            left: 0; /* ì™¼ìª½ì— ë°°ì¹˜ */
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            font-weight: bold;
            width: 20px; /* ì•„ì´ì½˜ ê³µê°„ */
            text-align: center;
        }

        .question-list li.answered-correct:after {
            content: 'O';
            color: #32CD32; /* ë¼ì„ê·¸ë¦° */
        }

        .question-list li.answered-incorrect:after {
            content: 'X';
            color: #FF4500; /* ì˜¤ë Œì§€ë ˆë“œ */
        }

        /* ìµœì¢… ì œì¶œ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” í•˜ë‹¨) */
        #submit-final-quiz-button {
            margin-top: auto; /* í•˜ë‹¨ìœ¼ë¡œ ë°€ì–´ëƒ„ */
            background-color: #FFA500; /* ì˜¤ë Œì§€ */
            color: white;
            padding: 15px 10px;
            border-radius: 10px;
            font-size: 1.4em;
            width: 100%; /* ë„ˆë¹„ ì „ì²´ ì‚¬ìš© */
            box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ ë„ˆë¹„ ê³„ì‚° */
        }
        #submit-final-quiz-button:hover {
            background-color: #FF8C00; /* ë‹¤í¬ì˜¤ë Œì§€ */
        }
    </style>
</head>
<body>
    <div class="container" id="quiz-container">
        <div id="start-screen">
            <h1>â­ ì‹ ë‚˜ëŠ” ì˜ì–´ ë‹¨ì–´ í€´ì¦ˆ! â­</h1>
            <p>ë„ì „ì ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
            <input type="text" id="playerName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <button class="button" onclick="startGame()">í€´ì¦ˆ ì‹œì‘! ğŸš€</button>
            <div id="welcomeMessage" style="margin-top: 20px; font-size: 1.3em; color: #8A2BE2;"></div>
        </div>

        <div id="quiz-area" class="hidden">
            <div class="progress-indicator" id="progress-indicator"></div>
            <h2 id="question-type-title"></h2>
            <p id="question"></p>
            <div id="options-container" class="options-grid"></div>
            <input type="text" id="answer-input" class="hidden" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
            <button class="button hidden" id="submit-button" onclick="checkAnswer()">í™•ì¸! âœ…</button>
            <div id="feedback" class="feedback"></div>
            <div id="feedback-buttons" class="hidden">
                <button class="button" id="try-again-button" onclick="tryAgain()">ë‹¤ì‹œ í’€ê¸° ğŸ”„</button>
                <button class="button" id="next-question-button" onclick="manualNextQuestion()">ë‹¤ìŒ ë¬¸ì œ â–¶ï¸</button>
            </div>
        </div>

        <div id="end-screen" class="hidden">
            <h1>ğŸ‰ í€´ì¦ˆ ë! ğŸ‰</h1>
            <p id="final-score" class="score"></p>
            <div id="summary-score" style="font-size: 1.4em; margin-top: 20px;"></div>
            <button class="button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸° ğŸˆ</button>
        </div>
    </div>

    <div class="stage-navigator hidden" id="stage-navigator">
        <div class="quiz-outline" id="quiz-outline">
            </div>
        <button class="button" id="submit-final-quiz-button" onclick="confirmSubmitQuiz()">í€´ì¦ˆ ì œì¶œ ğŸ†</button>
    </div>

    <script>
        const quizData = [
            { word: "bitter", meaning: "ì“´" },
            { word: "blackboard", meaning: "ì¹ íŒ" },
            { word: "blend", meaning: "í˜¼í•©í•˜ë‹¤" },
            { word: "blouse", meaning: "ë¸”ë¼ìš°ìŠ¤" },
            { word: "blue", meaning: "íŒŒë€,íŒŒë€ìƒ‰ì˜" },
            { word: "blue", meaning: "íŒŒë€ìƒ‰" },
            { word: "bicycle", meaning: "ìì „ê±°" },
            { word: "bleed", meaning: "í”¼ í˜ë¦¬ë‹¤" },
            { word: "blender", meaning: "ë¯¹ì„œê¸° (ë¸”ë Œë”)" }
        ];

        let currentQuizData = []; // í˜„ì¬ ë‹¨ê³„ì— ì‚¬ìš©ë  í€´ì¦ˆ ë°ì´í„° (ì…”í”Œëœ ìƒíƒœ)
        let currentQuestionIndex = 0;
        let score = 0;
        let playerName = '';
        let currentQuizSet = 0; // 0: ì‹œì‘, 1: ê°ê´€ì‹, 2: ì£¼ê´€ì‹(50% blind), 3: ì£¼ê´€ì‹(100% blind)
        let correctAnswersBySet = { 1: 0, 2: 0, 3: 0 };
        let incorrectAnswersBySet = { 1: 0, 2: 0, 3: 0 };
        // ê° ë¬¸ì œì˜ ì •ë‹µ ì—¬ë¶€ì™€ ì›ë³¸ quizData ì¸ë±ìŠ¤ (ì…”í”Œëœ ë¬¸ì œì˜ ì›ë³¸ ìœ„ì¹˜ ì¶”ì )
        // { 'set-questionIndex': { status: 'correct'/'incorrect', originalIndex: n } }
        let answeredQuestions = {}; 

        let autoAdvanceTimer; // ìë™ ì§„í–‰ íƒ€ì´ë¨¸

        const startScreen = document.getElementById('start-screen');
        const quizArea = document.getElementById('quiz-area');
        const endScreen = document.getElementById('end-screen');
        const playerNameInput = document.getElementById('playerName');
        const welcomeMessageDiv = document.getElementById('welcomeMessage');
        
        const progressIndicator = document.getElementById('progress-indicator');
        const questionTypeTitle = document.getElementById('question-type-title');
        const questionElement = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');
        const feedbackElement = document.getElementById('feedback');
        const feedbackButtonsContainer = document.getElementById('feedback-buttons');
        const tryAgainButton = document.getElementById('try-again-button');
        const nextQuestionButton = document.getElementById('next-question-button');
        const finalScoreElement = document.getElementById('final-score');
        const summaryScoreElement = document.getElementById('summary-score');

        const stageNavigator = document.getElementById('stage-navigator');
        const quizOutline = document.getElementById('quiz-outline');
        const submitFinalQuizButton = document.getElementById('submit-final-quiz-button'); // ìµœì¢… ì œì¶œ ë²„íŠ¼

        const welcomeMessages = [
            { msg: "ì•ˆë…•! ğŸš€ í€´ì¦ˆ ì •ë³µ ì¤€ë¹„ ì™„ë£Œ!"},
            { msg: "í™”ì´íŒ…! ğŸŒˆ ë„ˆì˜ ì‹¤ë ¥ì„ ë³´ì—¬ì¤˜!"},
            { msg: "ë„ì „! ğŸ’ª ì˜ë‹¨ì–´ ë°•ì‚¬ê°€ ë˜ì–´ë³´ì!"}
        ];

        function getRandomWelcome() {
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            return welcomeMessages[randomIndex];
        }

        function showScreen(screenId) {
            startScreen.classList.add('hidden');
            quizArea.classList.add('hidden');
            endScreen.classList.add('hidden');
            stageNavigator.classList.add('hidden'); 
            submitFinalQuizButton.classList.add('hidden'); // í•­ìƒ ìˆ¨ê¹€ (í•„ìš”í•  ë•Œë§Œ í‘œì‹œ)

            document.getElementById(screenId).classList.remove('hidden');
            if (screenId === 'quiz-area') {
                stageNavigator.classList.remove('hidden');
                submitFinalQuizButton.classList.remove('hidden'); // í€´ì¦ˆ ì˜ì—­ì—ì„œë§Œ ì œì¶œ ë²„íŠ¼ í‘œì‹œ
            }
        }

        function startGame() {
            playerName = playerNameInput.value.trim();
            if (playerName === '') {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
                return;
            }

            const randomWelcome = getRandomWelcome();
            welcomeMessageDiv.textContent = `${playerName}ë‹˜, ${randomWelcome.msg}`;
           
            setTimeout(() => {
                score = 0;
                currentQuizSet = 1;
                currentQuestionIndex = 0;
                correctAnswersBySet = { 1: 0, 2: 0, 3: 0 };
                incorrectAnswersBySet = { 1: 0, 2: 0, 3: 0 };
                answeredQuestions = {}; // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸°í™”

                renderQuizOutline(); // í€´ì¦ˆ ì•„ì›ƒë¼ì¸ ë Œë”ë§
                goToStage(1); // 1ë‹¨ê³„ë¡œ ì´ë™
                showScreen('quiz-area');
            }, 1500); // 1.5ì´ˆ í›„ í€´ì¦ˆ ì‹œì‘
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuizSet() {
            currentQuizData = shuffleArray([...quizData]); // í˜„ì¬ ë‹¨ê³„ì˜ ë°ì´í„°ë¥¼ ìƒˆë¡œ ì…”í”Œ
            clearTimeout(autoAdvanceTimer); // ì´ì „ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            feedbackElement.textContent = '';
            feedbackButtonsContainer.classList.add('hidden'); // í”¼ë“œë°± ë²„íŠ¼ ìˆ¨ê¹€
            showQuestion();
            highlightCurrentQuestion(); // í˜„ì¬ ë¬¸ì œ í•˜ì´ë¼ì´íŠ¸
        }

        function updateProgress() {
            progressIndicator.textContent = `(${currentQuizSet}/3ë‹¨ê³„) ${currentQuestionIndex + 1}/${currentQuizData.length} ë¬¸ì œ`;
        }

        function showQuestion() {
            clearTimeout(autoAdvanceTimer); // ë¬¸ì œ ë¡œë“œ ì‹œ ìë™ ë„˜ê¹€ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            feedbackElement.textContent = '';
            feedbackButtonsContainer.classList.add('hidden'); // í”¼ë“œë°± ë²„íŠ¼ ìˆ¨ê¹€

            optionsContainer.innerHTML = '';
            answerInput.value = '';
            answerInput.classList.add('hidden');
            submitButton.classList.add('hidden');
            optionsContainer.classList.remove('hidden');
            updateProgress();

            // í˜„ì¬ ë¬¸ì œ ì¸ë±ìŠ¤ê°€ ìœ íš¨í•œì§€ í™•ì¸
            if (currentQuestionIndex < 0 || currentQuestionIndex >= currentQuizData.length) {
                currentQuestionIndex = 0; // ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ ì²« ë¬¸ì œë¡œ ë¦¬ì…‹
            }

            const questionData = currentQuizData[currentQuestionIndex];

            if (currentQuizSet === 1) { // ê°ê´€ì‹: ë‹¨ì–´ë¥¼ ì œì‹œí•˜ê³  ëœ»ì„ ì°¾ëŠ”
                questionTypeTitle.textContent = "1ë‹¨ê³„: ì•Œë§ì€ ëœ» ì°¾ê¸°! (ê°ê´€ì‹)";
                questionElement.textContent = `ë‹¨ì–´: "${questionData.word}" ì˜ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?`;
                optionsContainer.classList.remove('hidden');
                answerInput.classList.add('hidden');
                submitButton.classList.add('hidden');

                const allMeanings = shuffleArray(quizData.map(d => d.meaning));
                let options = [questionData.meaning];
                while (options.length < 4) {
                    const randomMeaning = allMeanings[Math.floor(Math.random() * allMeanings.length)];
                    if (!options.includes(randomMeaning) && randomMeaning !== questionData.meaning) {
                        options.push(randomMeaning);
                    }
                }
                options = shuffleArray(options);

                options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option;
                    button.onclick = () => checkMultipleChoiceAnswer(button, option, questionData.meaning);
                    optionsContainer.appendChild(button);
                });

            } else if (currentQuizSet === 2) { // ì£¼ê´€ì‹: ëœ»ì„ ì œì‹œí•˜ê³  50% blindëœ ë‹¨ì–´ ì±„ìš°ê¸°
                questionTypeTitle.textContent = "2ë‹¨ê³„: ë‹¨ì–´ ì±„ìš°ê¸°! (ì£¼ê´€ì‹ - 50% ê°€ë¦¼)";
                optionsContainer.classList.add('hidden');
                answerInput.classList.remove('hidden');
                submitButton.classList.remove('hidden');
                answerInput.focus(); // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤

                const word = questionData.word;
                let maskedWord = '';
                const blindCount = Math.ceil(word.length * 0.5);
                const blindIndices = [];
                while (blindIndices.length < blindCount) {
                    const randomIndex = Math.floor(Math.random() * word.length);
                    if (!blindIndices.includes(randomIndex)) {
                        blindIndices.push(randomIndex);
                    }
                }
                for (let i = 0; i < word.length; i++) {
                    if (blindIndices.includes(i)) {
                        maskedWord += '_';
                    } else {
                        maskedWord += word[i];
                    }
                }
                questionElement.textContent = `ëœ»: "${questionData.meaning}" ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (${maskedWord})`;

            } else if (currentQuizSet === 3) { // ì£¼ê´€ì‹: ëœ»ì„ ì œì‹œí•˜ê³  100% blindëœ ë‹¨ì–´ ì±„ìš°ê¸°
                questionTypeTitle.textContent = "3ë‹¨ê³„: ë‹¨ì–´ ë§ì¶”ê¸°! (ì£¼ê´€ì‹ - ëª¨ë‘ ê°€ë¦¼)";
                optionsContainer.classList.add('hidden');
                answerInput.classList.remove('hidden');
                submitButton.classList.remove('hidden');
                answerInput.focus(); // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤

                const word = questionData.word;
                const maskedWord = '_'.repeat(word.length);
                questionElement.textContent = `ëœ»: "${questionData.meaning}" ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (${maskedWord})`;
            }
        }

        function checkMultipleChoiceAnswer(clickedButton, selectedOption, correctAnswer) {
            const allButtons = optionsContainer.querySelectorAll('.option-button');
            allButtons.forEach(button => button.disabled = true); // ì¤‘ë³µ í´ë¦­ ë°©ì§€

            const questionKey = `${currentQuizSet}-${currentQuestionIndex}`;

            if (selectedOption === correctAnswer) {
                clickedButton.classList.add('correct');
                feedbackElement.textContent = 'ğŸ‘ ì •ë‹µì´ì—ìš”!';
                feedbackElement.classList.remove('incorrect-feedback');
                feedbackElement.classList.add('correct-feedback');
                score += 10;
                correctAnswersBySet[currentQuizSet]++;
                answeredQuestions[questionKey] = 'correct';
                nextQuestionButton.classList.remove('hidden'); // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
                autoAdvanceTimer = setTimeout(nextQuestion, 2000); // 2ì´ˆ ë’¤ ìë™ ì§„í–‰
            } else {
                clickedButton.classList.add('incorrect');
                feedbackElement.textContent = 'ğŸ‘ ì•„!! í‹€ë ¸ì–´ìš”! ë‹¤ì‹œ í’€ì–´ ë³´ì•„ìš”!';
                feedbackElement.classList.remove('correct-feedback');
                feedbackElement.classList.add('incorrect-feedback');
                incorrectAnswersBySet[currentQuizSet]++;
                answeredQuestions[questionKey] = 'incorrect';
                
                feedbackButtonsContainer.classList.remove('hidden'); // ë‹¤ì‹œ í’€ê¸°/ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
            }
            highlightCurrentQuestion(); // ì •ë‹µ ì—¬ë¶€ì— ë”°ë¼ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = currentQuizData[currentQuestionIndex].word.toLowerCase();
            
            const questionKey = `${currentQuizSet}-${currentQuestionIndex}`;

            if (userAnswer === correctAnswer) {
                feedbackElement.textContent = 'ğŸ‘ ì •ë‹µì´ì—ìš”!';
                feedbackElement.classList.remove('incorrect-feedback');
                feedbackElement.classList.add('correct-feedback');
                score += 10;
                correctAnswersBySet[currentQuizSet]++;
                answeredQuestions[questionKey] = 'correct';
                nextQuestionButton.classList.remove('hidden'); // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
                autoAdvanceTimer = setTimeout(nextQuestion, 2000); // 2ì´ˆ ë’¤ ìë™ ì§„í–‰
            } else {
                feedbackElement.textContent = 'ğŸ‘ ì•„!! í‹€ë ¸ì–´ìš”! ë‹¤ì‹œ í’€ì–´ ë³´ì•„ìš”!';
                feedbackElement.classList.remove('correct-feedback');
                feedbackElement.classList.add('incorrect-feedback');
                incorrectAnswersBySet[currentQuizSet]++;
                answeredQuestions[questionKey] = 'incorrect';
                feedbackButtonsContainer.classList.remove('hidden'); // ë‹¤ì‹œ í’€ê¸°/ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
            }
            highlightCurrentQuestion(); // ì •ë‹µ ì—¬ë¶€ì— ë”°ë¼ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
        }

        // ì£¼ê´€ì‹ ì…ë ¥ í•„ë“œì—ì„œ ì—”í„° í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
        answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });

        function tryAgain() {
            clearTimeout(autoAdvanceTimer); // ìë™ ì§„í–‰ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            feedbackButtonsContainer.classList.add('hidden'); // ë²„íŠ¼ ìˆ¨ê¹€
            showQuestion(); // í˜„ì¬ ë¬¸ì œ ë‹¤ì‹œ í‘œì‹œ
        }

        function manualNextQuestion() {
            clearTimeout(autoAdvanceTimer); // ìë™ ì§„í–‰ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            feedbackButtonsContainer.classList.add('hidden'); // ë²„íŠ¼ ìˆ¨ê¹€
            nextQuestion(); // ë‹¤ìŒ ë¬¸ì œë¡œ ë°”ë¡œ ì§„í–‰
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizData.length) {
                showQuestion();
            } else {
                // í˜„ì¬ ë‹¨ê³„ì˜ ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ìë™ ì´ë™
                if (currentQuizSet < 3) {
                    feedbackElement.textContent = `ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤! (${currentQuizSet + 1}/3)`;
                    setTimeout(() => {
                        goToStage(currentQuizSet + 1);
                    }, 1500);
                } else {
                    // ëª¨ë“  ë‹¨ê³„ë¥¼ ë‹¤ í’€ì—ˆì–´ë„, ìµœì¢… ì œì¶œì€ ì œì¶œ ë²„íŠ¼ì„ í†µí•´ ì´ë£¨ì–´ì§€ë¯€ë¡œ,
                    // ì¶”ê°€ì ì¸ ìë™ ì¢…ë£ŒëŠ” í•˜ì§€ ì•ŠìŒ. ì‚¬ìš©ìê°€ ì§ì ‘ ì œì¶œ ë²„íŠ¼ì„ ëˆ„ë¥´ë„ë¡ ìœ ë„.
                    feedbackElement.textContent = 'ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤! í€´ì¦ˆ ì œì¶œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
                    feedbackButtonsContainer.classList.add('hidden');
                }
            }
        }

        function confirmSubmitQuiz() {
            if (confirm("í€´ì¦ˆë¥¼ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                endQuiz();
            }
        }

        function endQuiz() {
            showScreen('end-screen');
            finalScoreElement.textContent = `${playerName}ë‹˜! ì´ì : ${score}ì !`;

            let summaryHtml = '<h3>ë‹¨ê³„ë³„ ê²°ê³¼:</h3>';
            for (let i = 1; i <= 3; i++) {
                summaryHtml += `<p><strong>${i}ë‹¨ê³„:</strong> ë§ì€ ë¬¸ì œ: ${correctAnswersBySet[i]}ê°œ, í‹€ë¦° ë¬¸ì œ: ${incorrectAnswersBySet[i]}ê°œ</p>`;
            }
            summaryScoreElement.innerHTML = summaryHtml;
        }

        function restartGame() {
            showScreen('start-screen');
            playerNameInput.value = '';
            welcomeMessageDiv.textContent = '';
            // ëª¨ë“  í€´ì¦ˆ ë°ì´í„° ì´ˆê¸°í™”
            currentQuizData = [];
            currentQuestionIndex = 0;
            score = 0;
            currentQuizSet = 0;
            correctAnswersBySet = { 1: 0, 2: 0, 3: 0 };
            incorrectAnswersBySet = { 1: 0, 2: 0, 3: 0 };
            answeredQuestions = {};
            quizOutline.innerHTML = ''; // ì•„ì›ƒë¼ì¸ë„ ì´ˆê¸°í™”
            clearTimeout(autoAdvanceTimer); // íƒ€ì´ë¨¸ ì´ˆê¸°í™”
        }

        function renderQuizOutline() {
            quizOutline.innerHTML = ''; // ê¸°ì¡´ ì•„ì›ƒë¼ì¸ ì´ˆê¸°í™”

            for (let i = 1; i <= 3; i++) {
                const stageButton = document.createElement('button');
                stageButton.classList.add('nav-button');
                stageButton.id = `nav-stage-${i}`;
                stageButton.textContent = `${i}ë‹¨ê³„`;
                stageButton.onclick = () => toggleQuestionList(i); // í´ë¦­ ì‹œ ëª©ë¡ í† ê¸€
                quizOutline.appendChild(stageButton);

                const questionList = document.createElement('ul');
                questionList.classList.add('question-list');
                questionList.id = `question-list-stage-${i}`;
                
                for (let j = 0; j < quizData.length; j++) { // quizData.lengthëŠ” ì´ ë¬¸ì œ ìˆ˜
                    const questionItem = document.createElement('li');
                    questionItem.textContent = `${j + 1}ë²ˆ ë¬¸ì œ`;
                    questionItem.dataset.stage = i;
                    questionItem.dataset.index = j;
                    questionItem.onclick = () => goToQuestion(i, j);
                    questionList.appendChild(questionItem);
                }
                quizOutline.appendChild(questionList);
            }
        }

        function toggleQuestionList(stageNumber) {
            const list = document.getElementById(`question-list-stage-${stageNumber}`);
            // ë‹¤ë¥¸ ëª¨ë“  ëª©ë¡ ë‹«ê¸°
            document.querySelectorAll('.question-list').forEach(item => {
                if (item.id !== `question-list-stage-${stageNumber}`) {
                    item.classList.remove('open');
                }
            });
            // í´ë¦­í•œ ëª©ë¡ í† ê¸€
            list.classList.toggle('open');
            
            // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœ ì´ˆê¸°í™”
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-stage-${stageNumber}`).classList.add('active'); // í´ë¦­í•œ ë‹¨ê³„ ë²„íŠ¼ë§Œ í™œì„±í™”
        }

        function goToStage(stageNumber) {
            currentQuizSet = stageNumber;
            currentQuestionIndex = 0; // í•´ë‹¹ ë‹¨ê³„ì˜ ì²« ë¬¸ì œë¡œ ì´ë™
            loadQuizSet(); // í€´ì¦ˆ ë°ì´í„° ë¡œë“œ ë° ì§ˆë¬¸ í‘œì‹œ
            
            // ëª¨ë“  ë‹¨ê³„ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±° í›„ í˜„ì¬ ë‹¨ê³„ ë²„íŠ¼ì— ì¶”ê°€
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-stage-${stageNumber}`).classList.add('active');

            // í´ë¦­í•œ ë‹¨ê³„ì˜ ë¬¸ì œ ëª©ë¡ ì—´ê¸° (ë‹¤ë¥¸ ëª©ë¡ì€ ë‹«í˜)
            document.querySelectorAll('.question-list').forEach(list => list.classList.remove('open'));
            document.getElementById(`question-list-stage-${stageNumber}`).classList.add('open');
            
            showScreen('quiz-area');
            highlightCurrentQuestion(); // í˜„ì¬ ë¬¸ì œ í•˜ì´ë¼ì´íŠ¸
        }

        function goToQuestion(stageNumber, questionIndex) {
            currentQuizSet = stageNumber;
            currentQuestionIndex = questionIndex;
            loadQuizSet(); // í€´ì¦ˆ ë°ì´í„° ë¡œë“œ ë° ì§ˆë¬¸ í‘œì‹œ

            // í˜„ì¬ ë‹¨ê³„ ë²„íŠ¼ í™œì„±í™” ë° ë¬¸ì œ ëª©ë¡ ì—´ê¸°
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-stage-${stageNumber}`).classList.add('active');
            
            document.querySelectorAll('.question-list').forEach(list => list.classList.remove('open'));
            document.getElementById(`question-list-stage-${stageNumber}`).classList.add('open');
            
            showScreen('quiz-area');
            highlightCurrentQuestion(); // í˜„ì¬ ë¬¸ì œ í•˜ì´ë¼ì´íŠ¸
        }

        function highlightCurrentQuestion() {
            // ëª¨ë“  ë¬¸ì œ í•­ëª©ì˜ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.question-list li').forEach(item => {
                item.classList.remove('current', 'answered-correct', 'answered-incorrect');
            });

            // í˜„ì¬ ë¬¸ì œ í•˜ì´ë¼ì´íŠ¸
            const currentItem = document.querySelector(`#question-list-stage-${currentQuizSet} li[data-index="${currentQuestionIndex}"]`);
            if (currentItem) {
                currentItem.classList.add('current');
            }
            
            // ê° ë¬¸ì œì˜ ì •ë‹µ ì—¬ë¶€ì— ë”°ë¼ O/X í´ë˜ìŠ¤ ì¶”ê°€
            for (let s = 1; s <= 3; s++) {
                document.querySelectorAll(`#question-list-stage-${s} li`).forEach((item, idx) => {
                    const questionKey = `${s}-${idx}`;
                    if (answeredQuestions[questionKey] === 'correct') {
                        item.classList.add('answered-correct');
                    } else if (answeredQuestions[questionKey] === 'incorrect') {
                        item.classList.add('answered-incorrect');
                    }
                });
            }
        }

        // ì´ˆê¸° í™”ë©´ ì„¤ì •
        showScreen('start-screen');
    </script>
</body>
</html>